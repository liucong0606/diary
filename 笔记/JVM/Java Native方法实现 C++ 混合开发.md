# Java Native方法实现 C/C++ 混合开发

## Native

**Native方法：**Java为实现 `C/C++` 代码所作的接口。



## 案例实现

**1. 编写Java文件**

`native` 方法做 Java对接 `C/C++` 语言的接口。

`System.load()` 用来加载之后 C++ 文件编译后的动态链接文件。

```java
public class INative {
    native public void sing(String singer);

    static {
        System.load("C:\\Users\\zhuan\\Desktop\\test\\INativeImpl.dll");
    }

    public static void main(String[] args) {
        INative var = new INative();
        var.sing("周董");
    }
}
```



**2.  编译Java文件**

```bash
javac INative.java
```



**3. javah生成C文件**

`Javah` 执行后会生成 `.h` 的 C语言文件。

`Java_INative_sing` 相当于 `Java_类名_本地方法名`

```bash
javah -jni INative
```

```C
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class INative */

#ifndef _Included_INative
#define _Included_INative
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     INative
 * Method:    sing
 * Signature: (Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_INative_sing
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif

```



**数据类型转换关系**

![04_JNI数据类型转换关系](C:\rep\diary\笔记\JVM\doc\04_JNI数据类型转换关系.png)



**4. 复制该C文件改名.cpp，修改代码**

这个 C++ 文件需要引入 Java JNI生成的`INative.h`

`singer` 对应 Java Native方法的参数

```C
#include "INative.h"
#include <stdio.h>
#include <iostream>

using namespace std;

/*
 * Class:     INative
 * Method:    sing
 * Signature: (Ljava/lang/String;)V
 */
JNIEXPORT void JNICALL Java_INative_sing (JNIEnv * env, jobject obj, jstring singer)
{
    cout << env->GetStringUTFChars(singer, NULL) << "正在唱歌..." << endl;
}
```



**5. 生成动态链接文件**

在cmd执行以下指令，会生成一个动态链接dll文件

```bash
g++ -m64 INative.cpp -fPIC -shared -o C:\Users\zhuan\Desktop\test\INativeImpl.dll
```

* dll文件

![05_g++生成dll文件](C:\rep\diary\笔记\JVM\doc\05_g++生成dll文件.png)

**6. 执行Java文件**

```bash
java INative
```



* 成功样式

![06_本地方法执行成功](C:\rep\diary\笔记\JVM\doc\06_本地方法执行成功.png)